# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

Telegram Job Bot —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ Telegram Bot API –≤ —Ä–µ–∂–∏–º–µ Long Polling. –£ –±–æ—Ç–∞ –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.

–û–¥–Ω–∞–∫–æ, –±–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

## üìä Monitoring API (Prometheus)

–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus.

*   **–ü–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `8000` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `config.py` / `.env`)
*   **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/metrics`
*   **–§–æ—Ä–º–∞—Ç:** Prometheus Text Format

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ò–º—è –º–µ—Ç—Ä–∏–∫–∏ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–µ—Ç–∫–∏ (Labels) |
| :--- | :--- | :--- | :--- |
| `bot_messages_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π | `type` (incoming_message, callback_query) |
| `bot_errors_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–Ω–∏–∫—à–∏—Ö –æ—à–∏–±–æ–∫ | `type` (critical_exception, etc.) |
| `bot_processing_seconds` | Summary | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (latency) | - |
| `process_virtual_memory_bytes` | Gauge | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ | - |
| `process_cpu_seconds_total` | Counter | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU | - |

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus (`prometheus.yml`)

```yaml
scrape_configs:
  - job_name: 'telegram_bot'
    static_configs:
      - targets: ['bot-container:8000']
```

## üîó –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Sentry
–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.
–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `SENTRY_DSN`.

### Telegram API
–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `pyTelegramBotAPI`.
–í—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã API:
*   `sendMessage`
*   `sendPhoto`
*   `answerCallbackQuery`
*   `editMessageText`
